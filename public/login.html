<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Dynamic base path script - execute before anything else loads -->
    <script>
        // Function to get the base path from the current URL
        function getBasePath() {
            const path = window.location.pathname;
            // Find the last segment (after the last slash)
            const lastSlashIndex = path.lastIndexOf('/');
            if (lastSlashIndex <= 0) {
                // We're at the root
                return '';
            }
            
            let resultPath;
            
            // Check if the URL ends with index.html or similar
            const lastSegment = path.substring(lastSlashIndex + 1);
            if (lastSegment === '' || lastSegment.includes('.html')) {
                // Return everything before the last slash
                resultPath = path.substring(0, lastSlashIndex);
            } else {
                // Otherwise the entire path is our base
                resultPath = path;
            }
            
            // IMPORTANT: Always remove trailing slashes to prevent double slashes in URLs
            resultPath = resultPath.replace(/\/+$/, '');
            
            return resultPath;
        }
        
        // Set the base path as a global variable
        window.APP_BASE_PATH = getBasePath();
        console.log('Detected base path: "' + window.APP_BASE_PATH + '"');
        
        // Helper to get full resource path
        function getResourcePath(path) {
            // Normalize path to ensure it starts with exactly one slash
            const normalizedPath = path.replace(/^\/*/, '/');
            
            // If there's no app base path, just return the normalized path
            if (!window.APP_BASE_PATH) {
                return normalizedPath;
            }
            
            // If path already starts with the base path, return as is
            if (normalizedPath.startsWith(window.APP_BASE_PATH + '/') || normalizedPath === window.APP_BASE_PATH) {
                return normalizedPath;
            }
            
            // Ensure no double slashes when joining paths
            const fullPath = window.APP_BASE_PATH + normalizedPath;
            
            // Log the path construction for debugging
            console.log('Resource path construction:', {
                basePath: window.APP_BASE_PATH,
                resourcePath: path,
                normalizedPath: normalizedPath,
                fullPath: fullPath
            });
            
            return fullPath;
        }
        
        // Dynamically create a base element
        if (window.APP_BASE_PATH) {
            const baseElement = document.createElement('base');
            baseElement.href = window.APP_BASE_PATH + '/';
            document.head.appendChild(baseElement);
        }
    </script>
    
    <!-- Load server-generated config.js with dynamic path -->
    <script>
        document.write('<script src="' + getResourcePath('/config.js') + '"><\/script>');
    </script>
    <title>{{SITE_TITLE}}</title>
    <!-- Load other resources with dynamic paths -->
    <script>
        document.write('<link rel="icon" type="image/svg+xml" href="' + getResourcePath('/favicon.svg') + '">');
        document.write('<link rel="stylesheet" href="' + getResourcePath('/styles.css') + '">');
    </script>
    <script>
        // Debug logging for URL and protocol
        console.log('Current URL:', window.location.href);
        console.log('Current Protocol:', window.location.protocol);
        console.log('Base Path:', window.APP_BASE_PATH);
    </script>
</head>
<body>
    <main>
        <form id="pinForm" action="javascript:void(0);">
            <button id="themeToggle" aria-label="Toggle theme" type="button">
                <svg class="moon" viewBox="0 0 24 24">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
                <svg class="sun" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
            </button>
            <h1>{{SITE_TITLE}}</h1>
            <h2>Enter PIN</h2>
            <div class="pin-input-container"></div>
            <div class="pin-error" role="alert" aria-hidden="true">Incorrect PIN. Please try again.</div>
        </form>
    </main>
    <div class="dumbware-credit">
        A Dumbware by <a href="https://dumbware.io" target="_blank" rel="noopener noreferrer">Dumbware.io</a>
    </div>
    <!-- IMPORTANT: Do not modify this script type unless the entire file is fully structured as an ES module. -->
    <script>
        document.write('<script src="' + getResourcePath('/src/api-utils.js') + '"><\/script>');
        document.write('<script src="' + getResourcePath('/src/theme.js') + '"><\/script>');
        document.write('<script src="' + getResourcePath('/src/date-utils.js') + '"><\/script>');
        document.write('<script src="' + getResourcePath('/src/text-utils.js') + '"><\/script>');
        document.write('<script type="module" src="' + getResourcePath('/src/ui-utils.js') + '"><\/script>');
        document.write('<script type="module" src="' + getResourcePath('/src/state.js') + '"><\/script>');
        document.write('<script type="module" src="' + getResourcePath('/src/auth-storage.js') + '"><\/script>');
        document.write('<script type="module" src="' + getResourcePath('/src/login-utils.js') + '"><\/script>');
        document.write('<script type="module" src="' + getResourcePath('/src/element-init.js') + '"><\/script>');
        document.write('<script src="' + getResourcePath('/src/task-modal.js') + '"><\/script>');
        document.write('<script src="' + getResourcePath('/src/task-utils.js') + '"><\/script>');
        document.write('<script type="module" src="' + getResourcePath('/src/drag-drop-utils.js') + '"><\/script>');
        document.write('<script type="module" src="' + getResourcePath('/src/board-utils.js') + '"><\/script>');
        document.write('<script type="module" src="' + getResourcePath('/src/event-listeners.js') + '"><\/script>');
        document.write('<script type="module" src="' + getResourcePath('/src/data-loading.js') + '"><\/script>');
        document.write('<script type="module" src="' + getResourcePath('/src/render-utils.js') + '"><\/script>');
        document.write('<script type="module" src="' + getResourcePath('/src/render-init.js') + '"><\/script>');
        document.write('<script type="module" src="' + getResourcePath('/src/app-init.js') + '"><\/script>');
        document.write('<script type="module" src="' + getResourcePath('/src/app-bootstrap.js') + '"><\/script>');
    </script>
    <script>
        // Update the form action to use the dynamic base path
        document.addEventListener('DOMContentLoaded', function() {
            const pinForm = document.getElementById('pinForm');
            if (pinForm) {
                pinForm.setAttribute('action', getResourcePath('/verify-pin'));
                console.log('Updated form action to:', pinForm.getAttribute('action'));
            }
        });
    </script>
</body>
</html> 